# Custom Compliance Framework (GitLab 17.11+)
# Block 8: Enterprise compliance requirements

name: "Enterprise Security & Compliance"
description: "Production-ready compliance framework with security gates and approval workflows"

# Approval Requirements
approval_policy:
  approvals_required: 2
  approval_rules:
    - name: "Security Team Review"
      approvals_required: 1
      groups: ["security-team"]
      rule_type: "security"
      
    - name: "Technical Lead Review"  
      approvals_required: 1
      groups: ["tech-leads"]
      rule_type: "technical"

# Branch Protection
branch_protection:
  main:
    push_access_levels: ["maintainer"]
    merge_access_levels: ["developer"]
    unprotect_access_levels: ["maintainer"]
    allow_force_push: false
    code_owner_approval_required: true

# Security Scanning Requirements
security_policy:
  dependency_scanning:
    enabled: true
    block_on: ["critical", "high"]
    
  container_scanning:
    enabled: true
    block_on: ["critical", "high"]
    
  sast:
    enabled: true
    block_on: ["critical", "high"]
    
  secret_detection:
    enabled: true
    block_on: ["critical"]
    
  license_compliance:
    enabled: true
    approved_licenses:
      - "MIT"
      - "Apache-2.0" 
      - "BSD-3-Clause"
      - "ISC"
    denied_licenses:
      - "GPL-3.0"
      - "AGPL-3.0"

# Deployment Gates
deployment_policy:
  production:
    requires_approval: true
    approval_timeout: "4 hours"
    auto_rollback_on_failure: true
    
  staging:
    requires_approval: false
    auto_rollback_on_failure: true

# Quality Gates
quality_policy:
  sonarqube:
    quality_gate_required: true
    coverage_threshold: 80
    
  test_coverage:
    minimum_coverage: 75
    block_on_failure: true

# Audit Requirements  
audit_policy:
  log_all_deployments: true
  require_change_reason: true
  retention_period: "1 year"

# Pipeline Requirements
pipeline_policy:
  required_jobs:
    - "build:matrix"
    - "container_scanning"
    - "dependency_scanning"
    - "sast"
    - "secret_detection"
    - "quality:sonar"
    
  allowed_to_skip: []
  
# DORA Metrics Tracking
metrics_policy:
  track_deployment_frequency: true
  track_lead_time: true
  track_mttr: true
  track_change_failure_rate: true
  
# Notification Requirements
notification_policy:
  security_findings: 
    notify: ["security-team@company.com"]
    severity: ["critical", "high"]
    
  deployment_failures:
    notify: ["tech-leads@company.com", "devops@company.com"]
    
  compliance_violations:
    notify: ["compliance@company.com"]

# Integration Requirements
integration_policy:
  required_integrations:
    - "slack"
    - "email"
    
  optional_integrations:
    - "jira"
    - "pagerduty"